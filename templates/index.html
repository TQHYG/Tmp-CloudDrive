<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>炸弹盘临时文件网盘</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e74c3c;
            --primary-dark: #c0392b;
            --secondary: #3498db;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--dark), var(--primary-dark));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .warning-banner {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            color: #d35400;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .warning-banner i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-card h2 {
            margin-top: 0;
            color: var(--dark);
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .stats-card h2 i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .disk-usage {
            margin-top: 15px;
        }
        
        .usage-bar {
            height: 25px;
            background-color: var(--light);
            border-radius: 12px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        
        .usage-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .smart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }
        
        .smart-item {
            background-color: #f8f9fa;
            padding: 15px 10px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .smart-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .smart-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--dark);
        }
        
        .health-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .health-warning {
            background-color: #fef9e7;
            color: #d35400;
        }
        
        .upload-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: #fff9f8;
        }
        
        .upload-area i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .upload-area h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .upload-area p {
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .browse-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .browse-btn:hover {
            background-color: var(--primary-dark);
        }
        
        #file-input {
            display: none;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            border-radius: 6px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .file-list {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .refresh-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .refresh-btn i {
            margin-right: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: var(--dark);
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .file-name {
            display: flex;
            align-items: center;
        }
        
        .file-icon {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .download-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        
        .download-btn i {
            margin-right: 5px;
        }
        
        .file-size {
            font-family: monospace;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background-color: var(--success);
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .toast.error {
            background-color: var(--danger);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .upload-area {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-bomb"></i> 炸弹盘临时文件网盘</h1>
            <p>高风险存储 - 文件最多保留3天 - 随时可能丢失数据</p>
        </div>

        <div class="warning-banner">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>警告：</strong> 此服务使用即将损坏的硬盘，文件存储不稳定，请勿存储重要数据！
        </div>

        <div class="stats-container">
            <div class="stats-card">
                <h2><i class="fas fa-hdd"></i> 磁盘使用情况</h2>
                <div class="disk-usage">
                    <div class="usage-bar">
                        <div class="usage-fill" id="usage-fill" style="width: {{ disk_usage.percent_used }}%;"></div>
                    </div>
                    <div class="usage-stats">
                        <span>已用: {{ (disk_usage.used / (1024**3)) | round(2) }} GB</span>
                        <span>可用: {{ (disk_usage.free / (1024**3)) | round(2) }} GB</span>
                    </div>
                    <div class="usage-stats">
                        <span>总计: {{ (disk_usage.total / (1024**3)) | round(2) }} GB</span>
                        <span>使用率: {{ disk_usage.percent_used }}%</span>
                    </div>
                </div>
            </div>

            <div class="stats-card">
                <h2><i class="fas fa-heartbeat"></i> 硬盘健康状态</h2>
                <div class="smart-grid">
                    <div class="smart-item">
                        <div class="smart-label">坏块数量</div>
                        <div class="smart-value">{{ smart_data.bad_blocks }}</div>
                    </div>
                    <div class="smart-item">
                        <div class="smart-label">重分配扇区</div>
                        <div class="smart-value">{{ smart_data.reallocated_sectors }}</div>
                    </div>
                    <div class="smart-item">
                        <div class="smart-label">不可纠正错误</div>
                        <div class="smart-value">{{ smart_data.uncorrectable_errors }}</div>
                    </div>
                    <div class="smart-item">
                        <div class="smart-label">温度 (°C)</div>
                        <div class="smart-value">{{ smart_data.temperature }}</div>
                    </div>
                    <div class="smart-item">
                        <div class="smart-label">通电时间 (小时)</div>
                        <div class="smart-value">{{ smart_data.power_on_hours }}</div>
                    </div>
                </div>
                <div class="health-status health-warning">
                    <i class="fas fa-exclamation-circle"></i> {{ smart_data.health_status }}
                </div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-header">
                <h2><i class="fas fa-cloud-upload-alt"></i> 上传文件</h2>
                <div>
                    <span class="file-size">最大文件: {{ (max_file_size / (1024 * 1024)) | int }} MB</span>
                </div>
            </div>
            
            <div class="upload-area" id="upload-area">
                <i class="fas fa-file-upload"></i>
                <h3>拖放文件到此处或点击上传</h3>
                <p>支持格式: {{ allowed_extensions }}</p>
                <button class="browse-btn">选择文件</button>
                <input type="file" id="file-input" name="file">
            </div>
            
            <div class="progress-container" id="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span id="progress-percent">0%</span>
                    <span id="progress-status">等待上传...</span>
                </div>
            </div>
        </div>

        <div class="file-list">
            <div class="section-header">
                <h2><i class="fas fa-file-alt"></i> 文件列表</h2>
                <button class="refresh-btn" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
            </div>
            
            <div id="file-list-container">
                {% if files %}
                <table>
                    <thead>
                        <tr>
                            <th>文件名</th>
                            <th>大小</th>
                            <th>上传时间</th>
                            <th>过期时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr>
                            <td>
                                <div class="file-name">
                                    <i class="fas fa-file file-icon"></i>
                                    {{ file.name }}
                                </div>
                            </td>
                            <td class="file-size">{{ (file.size / (1024 * 1024)) | round(2) }} MB</td>
                            <td>{{ file.upload_time }}</td>
                            <td>{{ file.expire_time }}</td>
                            <td>
                                <a href="{{ file.download_url }}" class="download-btn">
                                    <i class="fas fa-download"></i> 下载
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <h3>暂无文件</h3>
                    <p>上传文件将显示在此处</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">文件上传成功!</span>
    </div>

    <script>
        // 文件上传处理
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const progressPercent = document.getElementById('progress-percent');
        const progressStatus = document.getElementById('progress-status');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const refreshBtn = document.getElementById('refresh-btn');
        const fileListContainer = document.getElementById('file-list-container');
        
        // 点击上传区域触发文件选择
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // 拖放功能
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#e74c3c';
            uploadArea.style.backgroundColor = '#fff9f8';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.backgroundColor = '#fafafa';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.backgroundColor = '#fafafa';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload(fileInput.files[0]);
            }
        });
        
        // 文件选择变化时处理上传
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        // 处理文件上传
        function handleFileUpload(file) {
            // 显示进度条
            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';
            progressPercent.textContent = '0%';
            progressStatus.textContent = '开始上传...';
            
            const formData = new FormData();
            formData.append('file', file);
            
            const xhr = new XMLHttpRequest();
            
            // 上传进度事件
            xhr.upload.addEventListener('progress', (e) => {
                if (e.lengthComputable) {
                    const percent = (e.loaded / e.total) * 100;
                    progressFill.style.width = `${percent}%`;
                    progressPercent.textContent = `${Math.round(percent)}%`;
                    progressStatus.textContent = '上传中...';
                }
            });
            
            // 上传完成事件
            xhr.addEventListener('load', () => {
                if (xhr.status === 200) {
                    const response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        // 显示成功消息
                        showToast(response.message);
                        
                        // 更新文件列表
                        refreshFileList();
                        
                        // 重置文件输入
                        fileInput.value = '';
                    } else {
                        showToast(response.message, true);
                    }
                } else {
                    showToast('上传失败: ' + xhr.statusText, true);
                }
                
                // 隐藏进度条
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 2000);
            });
            
            // 错误处理
            xhr.addEventListener('error', () => {
                showToast('上传过程中发生错误', true);
                progressContainer.style.display = 'none';
            });
            
            // 发送请求
            xhr.open('POST', '/upload', true);
            xhr.send(formData);
        }
        
        // 显示提示消息
        function showToast(message, isError = false) {
            toastMessage.textContent = message;
            
            if (isError) {
                toast.classList.add('error');
            } else {
                toast.classList.remove('error');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 刷新文件列表
        function refreshFileList() {
            fetch('/file_info')
                .then(response => response.json())
                .then(files => {
                    if (files.length === 0) {
                        fileListContainer.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <h3>暂无文件</h3>
                                <p>上传文件将显示在此处</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let tableHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>文件名</th>
                                    <th>大小</th>
                                    <th>上传时间</th>
                                    <th>过期时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    files.forEach(file => {
                        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                        
                        tableHTML += `
                            <tr>
                                <td>
                                    <div class="file-name">
                                        <i class="fas fa-file file-icon"></i>
                                        ${file.name}
                                    </div>
                                </td>
                                <td class="file-size">${sizeMB} MB</td>
                                <td>${file.upload_time}</td>
                                <td>${file.expire_time}</td>
                                <td>
                                    <a href="${file.download_url}" class="download-btn">
                                        <i class="fas fa-download"></i> 下载
                                    </a>
                                </td>
                            </tr>
                        `;
                    });
                    
                    tableHTML += `
                            </tbody>
                        </table>
                    `;
                    
                    fileListContainer.innerHTML = tableHTML;
                });
        }
        
        // 刷新按钮事件
        refreshBtn.addEventListener('click', refreshFileList);
        
        // 初始加载完成后显示磁盘使用动画
        window.addEventListener('load', () => {
            const usageFill = document.getElementById('usage-fill');
            const percent = parseFloat(usageFill.style.width);
            usageFill.style.width = '0%';
            
            setTimeout(() => {
                usageFill.style.width = percent + '%';
            }, 500);
        });
    </script>
</body>
</html>